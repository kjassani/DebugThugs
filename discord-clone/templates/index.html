<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Discord Clone</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='page_main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='reset.css') }}">
</head>
<body>
<div id="page">
    <div id="sidebar">
      <div id="sidebar_left">
        <div id="but">
            <a href="page_friends.html"><img src="{{ url_for('static', filename='icon_server.png') }}"></a>
        </div>
        <div id="but">
            <a href="page_friends.html"><img src="{{ url_for('static', filename='icon_friends.png') }}"></a>
        </div>
      </div>
      <div id="sidebar_right">
        <!-- Channels Section -->
        <div id="channels_section">
          <div id="sidebar_right_header">
            <h1>Channels</h1>
          </div>
          <div id="sidebar_right_content">
            {% if current_user.is_authenticated %}
              <ul>
                  {% for room in rooms %}
                      <li><a href="/rooms/{{ room['_id'] }}">{{ room['name'] }}</a></li>
                  {% endfor %}
              </ul>
              <a href="/create-room" class="btn">Create Room</a>
            {% endif %}
          </div>
        </div>
        <!-- Friends Section -->
        <div id="friends_section">
          <div id="sidebar_right_header">
            <h1>Friends</h1>
          </div>
          <div id="sidebar_right_content">
            {% if current_user.is_authenticated %}
              <ul>
                  {% for user in users %}
                      <li><a href="javascript:void(0);" onclick="startPrivateChat('{{ user['_id'] }}')">{{ user['_id'] }}</a></li>
                  {% endfor %}
              </ul>
            {% endif %}
          </div>
        </div>
        <div id="sidebar_right_footer">
          <div id="profile_info"> <h3>Hello {% if current_user.is_authenticated %}{{ current_user.username }}{% else %}Guest{% endif %}!</h3></div>
          <a href="page_editProfile.html"><img id="icon_settings" src="{{ url_for('static', filename='icon_settings.png') }}"></a>
        </div>
      </div>
    </div>
    <div id="content_main">
      <div id="content_main_header">
        <div id="top_title">
          <h1>Main Server</h1>
        </div>
      </div>
      <div id="content_main_body">
        <!-- Content dynamically loaded based on the selected room -->
      </div>
      <div id="content_main_footer">
        <div id="chat_entry">
            <textarea id="input_chat_entry" placeholder="Type a message!"></textarea>
        </div>
      </div>
    </div>
  </div>
  <script>
    function startPrivateChat(username) {
      fetch(`/start_private_chat/${username}`)
      .then(response => {
          if (!response.ok) {
              throw new Error('Failed to start private chat');
          }
          return response.json();
      })
      .then(data => {
          window.location.href = `/rooms/${data.room_id}`;
      })
      .catch(error => {
          console.error('Error starting private chat:', error);
          alert('Error starting private chat. Please try again.');
      });
  }  
</script>
    
</body>
</html>
